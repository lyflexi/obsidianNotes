
之前在kubernetes中完成的所有操作都是通过命令行工具kubectl完成的。其实，为了提供更丰富的用户体验，kubernetes还开发了一个基于web的用户界面（DashBoard）。用户可以使用DashBoard部署容器化的应用，而且还可以监控应用的状态，执行故障排查以及管理kubernetes中的各种资源。

# 2 部署DashBoard

  

## 2.1 下载yaml，并运行DashBoard

  

下载yaml（网络不行，请点这里[📎recommended.yaml](https://www.yuque.com/attachments/yuque/0/2021/yaml/750797/1625816410964-1a54e93a-adc2-4fcf-8018-6731eb888e10.yaml)）：

```
wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml
```

修改kubernetes-dashboard的Service类型
```
vim recommended.yaml
```
recommended.yaml
```
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kubernetes-dashboard
spec:
  type: NodePort # 新增
  ports:
    - port: 443
      targetPort: 8443
      nodePort: 30009 # 新增
  selector:
    k8s-app: kubernetes-dashboard
```
![[Pasted image 20240201103337.png]]

部署DashBoard：
```
kubectl create -f recommended.yaml
```

![[Pasted image 20240201103343.png]]
查看namespace为kubernetes-dashboard下的资源：
```
kubectl get pod,svc -n kubernetes-dashboard
```

![[Pasted image 20240201103350.png]]
## 2.2 创建账户，获取token

  

创建账户：
```
kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard
```

  ![[Pasted image 20240201103515.png]]

授权：
```
kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin
```

![[Pasted image 20240201103522.png]]
  
获取账号token：
```
kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin
```
![[Pasted image 20240201103526.png]]


```
kubectl describe secrets dashboard-admin-token-b992l -n kubernetes-dashboard
```
![[Pasted image 20240201103531.png]]
## 2.3 通过浏览器访问DashBoard的UI

  
在登录页面上输入上面的token，访问地址为[https://192.168.18.100:30009/#/login](https://192.168.18.100:30009/#/login)：

![](https://cdn.nlark.com/yuque/0/2021/png/513185/1610074900379-20661743-2dbc-40cd-86e8-d19ce778ffcb.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_14%2Ctext_6K645aSn5LuZ%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10)

  

出现下面的页面代表成功部署DashBoard：
![[Pasted image 20240201103645.png]]
# 说明:

 升级了新版本的Dashboard（这里使用的v1.8.3），使用了较为复杂的双因子登录，正确输入用户名和密码之后还需要Token或者kubeconfig再次认证，保障了系统安全，同时也带来了一些不便。默认的Token失效时间DefaultTokenTTL是900秒，也就是15分钟，这意味着你每隔15分钟就要认证一次。

```
// Expiration time (in seconds) of tokens generated by dashboard. Default: 15 min.
DefaultTokenTTL = 900
```

Dashboard的Token失效时间可以通过 token-ttl 参数来设置，修改创建Dashboard的yaml文件，并重新创建即可。

```
ports:
- containerPort: 8443
  protocol: TCP
args:
  - --auto-generate-certificates
  - --token-ttl=43200
```