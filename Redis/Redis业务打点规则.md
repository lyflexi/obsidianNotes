Redis一般我们会把它用作于缓存，当然啦，日常有的应用场景比较简单，用个HashMap也能解决很多的问题了，没必要上Redis
# 实时消息打点
总体来讲消息链路追踪分为三个步骤：
1. 实时消息存储
2. 业务标识模板
3. 定义打点规则

我这边负责消息管理平台，简单来说就是发消息的，其中实时的数据我们就用Redis来进行存储（离线的数据我们是存储到MySQL或者Hive的）
发完消息后我们需要知道消息有没有下发成功，于是我们系统有一套针对Redis完整的链路追踪体系
## 业务标识

对消息进行实时链路追踪，我这边就用了Redis好几种的数据结构分别有Set、List和Hash
要在消息管理平台发消息，首先得在后台新建一个「模板」，有模板自然会有一个模板ID，再对模板ID进行扩展比如说加上日期和固定的业务参数，形成的ID可以唯一标识某个模板的下发链路，在系统上，我这边叫它为UMPID：Unified Multi-Purpose Identification唯一的多用途的身份ID
## 打点规则

在发送入口处会对所有需要下发的消息打上模板ID：UMPID，然后根据不同维度进行处理。比如说：

- Set结构`[key日期--Set<value>]`：我要看某一天下发的所有模板有哪些，就以key为日期，将对应UMPID扔到Set就好了
- List结构`[key用户--LinkList<value>]`：我要看某个用户当天下发的消息整体链路是如何。用的是List结构，Key是userId，Value则是UMPID+state(关键点位)+processTime（处理时间)
- Hash结构`[key模板--Hash<key状态--value>]`：我要看某一个模板的消息下发的整体链路情况，那我以UMPID为Key，Value是Hash结构，Key是state，Value则是人数，这里的state我们在下发的过程中打的关键点位，比如接收到消息打个51，消息被去重了打个61，消息成功下发了打个81…
