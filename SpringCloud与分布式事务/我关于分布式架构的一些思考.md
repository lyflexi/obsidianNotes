微服务是为了服务拆分，是为了追求三高架构，极致发挥服务性能
# 三高架构
## 高可用
微服务开发完之后要进行部署，肯定不能把所有鸡蛋都放在一个篮子里面，因此会采用分布式部署方案：
即，把服务部署在不同的服务器节点上，这样当其中任意节点出现故障，不会影响全局，这就是高可用
## 高并发
==还有为了应对高并发，也会采取分布式+集群部署方案，因为单台服务器能够同时应对的并发数量是有限的==
再从微观层面讲，单一服务tomcat能够同时应对的并发数量也是有限的
比如，有两个接口是无需登录即可访问的，经过测试，目前`/search/list` 是比较正常的，访问耗时在30毫秒左右。
- `http://localhost:8080/hi`
- `http://localhost:8080/search/list`
接下来，我们假设`/hi`这个接口是一个并发较高的热点接口，并且设置了睡眠时间来模拟长业务操作，我们通过Jemeter来模拟5000个用户不停访问`/hi`接口。这就服务端导致每秒能处理的请求数量有限，最终会有越来越多请求积压，直至Tomcat资源耗尽。这样，其它本来正常的接口（例如`/search/list`）也都会被拖慢，甚至因超时而无法访问了。
## 高性能
最后是为了高性能，也会采取分布式+集群部署方案，因为单台服务器的容量（内存，CPU）资源也是有限的

# 分布式带来的问题
三高性能固然是每位开发者追求的，但与此同时分布式架构也带来了很大的问题，需要我们去解决。

银行跨行转账业务是一个典型分布式场景，假设A需要跨行转账给B，那么就涉及两个银行的数据，无法通过一个数据库的本地事务保证转账的ACID，用户A-100操作和用户B+100操作不是位于同一个节点上，只能够通过分布式事务来解决。分布式事务在分布式环境下，为了满足可用性、性能与降级服务的需要，降低一致性的要求遵循CAP理论或者BASE理论
## CAP理论
Consistency：一致性，数据在多个副本中能保持一致的状态。
Availability：高可用，整个系统在任何时刻都能提供可用的服务，通常达到99.99%四个九可以称为高可用
PartitionTolerance：分区容错性。服务器需要有容错性，因此P肯定存在
因此上面的三种特性只有下述两种组合方式：
- CP：满足一致性和分区容错性，通常性能不是特别高。
- AP：满足可用性和分区容错性，对一致性要求低一些，大多数建站首选
## Base理论
开发者为了追求极致的强一致性C，应用系统的高可用性A，不可避免的会导致分区容错性P降低。
==Base理论也不允许分区容错性P的降低，可见Base理论和CAP理论的出发点和落脚点其实都是一样的。==
因此Base理论提出了最终一致性的思想，指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。最终一致性的支撑是柔性状态`SoftState`和基本可用`BasicallyAvailable`
- 柔性状态SoftState：允许系统存在中间状态，允许不同副本延时同步
- 基本可用BasicallyAvailable：允许损失部分可用性，比如响应时间上的损失和暂时关闭非核心功能模块

# 落地方案

## 分布式锁DistributedLock
...
## 分布式事务GlobalTranscationcal
...
